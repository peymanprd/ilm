<script setup lang="ts">
import TheLogo from '@/components/TheLogo.vue'
import Modal from '@/components/shared/Modal.vue'

import { ref, watch } from 'vue'
import { useRoute, useRouter } from 'vue-router'

const isActiveModal = ref(false)
const toggleModal = () => (isActiveModal.value = !isActiveModal.value)

const savedCities = ref([])
const route = useRoute()
const router = useRouter()

watch(route, () => isActiveModal.value && toggleModal(), { deep: true })

function addCity() {
  if (localStorage.savedCities) {
    savedCities.value = JSON.parse(localStorage.savedCities)
  }
  const { state, city } = route.params
  const { lat, lng } = route.query
  const cityObj = {
    id: Math.floor(Math.random() * 999),
    state,
    city,
    coords: { lat, lng, preview: 1 },
  }

  savedCities.value.push(cityObj)
  localStorage.savedCities = JSON.stringify(savedCities.value)

  let query = Object.assign({}, route.query)
  delete query.preview
  query.id = cityObj.id
  router.replace({ query })
}
function removeCity() {
  const cities = JSON.parse(localStorage.savedCities)
  const updatedCities = cities.filter((city) => city.id !== +route.query.id)
  localStorage.savedCities = JSON.stringify(updatedCities)
  router.push('/')
}
function toggleTheme() {
  if (!localStorage.theme) localStorage.theme = 'dark'
  else localStorage.removeItem('theme')
  setTheme()
}
function setTheme() {
  if (localStorage.theme === 'dark') {
    document.documentElement.classList.add('dark')
    return
  }
  document.documentElement.classList.remove('dark')
}

setTheme()
</script>

<template>
  <header
    class="sticky top-0 border-b border-zinc-200 bg-white dark:bg-zinc-800 dark:border-zinc-700"
  >
    <Modal :is-active="isActiveModal" @close="toggleModal">
      Guide teloranse
      <template #body>
        <h2 class="text-sm font-medium">About :</h2>
        <p class="text-xs leading-5 mt-2">
          Lorem ipsum dolor, sit amet consectetur adipisicing elit. Error ab
          voluptas molestias. Quasi quisquam alias modi quaerat.
        </p>
        <h2 class="text-sm font-medium mt-4">About :</h2>
        <p class="text-xs leading-5 mt-2">
          1.Lorem ipsum dolor, sit amet consectetur adipisicing elit.
          <br />
          2. Error ab voluptas molestias. Quasi quisquam alias modi quaerat.
          <br />
          3.Lorem ipsum dolor, sit amet consectetur adipisicing elit.
        </p>
        <h2 class="text-sm font-medium mt-4">About :</h2>
        <p class="text-xs leading-5 mt-2">
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Consectetur,
          repellat repudiandae. Tempora ea vitae quisquam architecto, repellat
          assumenda enim non exercitationem laudantium nihil repudiandae
          voluptatum cum natus nostrum quae neque.
        </p>
      </template>
    </Modal>
    <nav
      class="container flex items-center gap-4 text-sm font-medium text-zinc-900 py-2.5"
    >
      <RouterLink to="/">
        <div class="flex items-center gap-3 flex-1">
          <TheLogo />
          <svg
            class="relative -left-5 -z-10"
            width="32"
            height="32"
            viewBox="0 0 112.891 75.295"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g
              id="svgGroup"
              stroke-linecap="round"
              fill-rule="evenodd"
              font-size="9pt"
              stroke="#000"
              stroke-width="0.25mm"
              fill="#000"
              class="fill-zinc-800 stroke-zinc-800 dark:fill-white dark:stroke-white"
            >
              <path
                d="M 48.584 73.585 L 46.191 73.487 L 45.313 73.487 Q 44.921 73.37 44.483 73.064 A 4.956 4.956 0 0 1 44.263 72.901 Q 43.702 72.463 43.409 72.267 A 3.638 3.638 0 0 0 43.408 72.266 A 0.599 0.599 0 0 1 43.18 71.969 Q 43.139 71.863 43.124 71.729 A 1.524 1.524 0 0 1 43.115 71.558 A 2.242 2.242 0 0 1 43.139 71.256 Q 43.209 70.754 43.48 69.862 A 22.646 22.646 0 0 1 43.506 69.776 Q 50.359 54.7 56.883 43.974 A 132.232 132.232 0 0 1 61.914 36.28 A 4.749 4.749 0 0 1 63.165 35.094 Q 63.96 34.564 65.063 34.205 A 14.444 14.444 0 0 1 67.797 33.588 A 12.346 12.346 0 0 1 69.287 33.497 A 1.021 1.021 0 0 1 70.261 34.075 Q 70.488 34.508 70.506 35.266 A 5.626 5.626 0 0 1 70.508 35.401 Q 70.508 35.938 70.117 36.842 A 5.264 5.264 0 0 1 69.854 37.356 Q 69.342 38.25 68.164 39.796 A 146.49 146.49 0 0 1 66.685 41.702 Q 65.917 42.676 65.046 43.753 A 261.199 261.199 0 0 1 64.453 44.483 Q 62.624 46.728 62.14 47.345 A 10.243 10.243 0 0 0 62.012 47.511 Q 68.701 40.577 74.097 37.183 A 50.066 50.066 0 0 1 76.315 35.861 Q 79.738 33.948 81.611 33.802 A 3.845 3.845 0 0 1 81.909 33.79 Q 83.882 33.79 85.107 34.717 A 3.983 3.983 0 0 1 85.62 35.181 A 5.447 5.447 0 0 1 86.409 36.253 A 3.894 3.894 0 0 1 86.914 38.16 Q 86.914 39.747 86.694 40.797 A 7.84 7.84 0 0 1 86.333 42.004 A 10.362 10.362 0 0 1 85.889 42.994 Q 85.486 43.783 85.164 44.41 A 431.494 431.494 0 0 1 84.888 44.947 A 8.324 8.324 0 0 1 84.578 45.491 Q 84.228 46.059 83.681 46.8 A 31.928 31.928 0 0 1 83.496 47.047 A 2255.187 2255.187 0 0 0 83.059 47.626 Q 82.578 48.264 82.303 48.63 A 229.698 229.698 0 0 0 82.153 48.829 A 13.419 13.419 0 0 1 81.956 49.085 Q 81.634 49.492 81.034 50.213 A 158.151 158.151 0 0 1 80.64 50.684 A 276.01 276.01 0 0 0 80.369 51.007 Q 79.537 52.002 79.409 52.178 A 0.619 0.619 0 0 0 79.395 52.198 Q 80.441 51.151 82.118 49.332 A 241.677 241.677 0 0 0 83.203 48.145 A 746.886 746.886 0 0 1 84.377 46.857 Q 86.066 45.008 87.329 43.653 Q 88.619 42.27 90.409 40.615 A 93.86 93.86 0 0 1 91.553 39.576 A 48.206 48.206 0 0 1 93.709 37.753 Q 95.053 36.686 96.289 35.889 A 22.61 22.61 0 0 1 101.432 33.452 A 18.097 18.097 0 0 1 106.982 32.569 A 4.853 4.853 0 0 1 108.642 32.844 A 4.294 4.294 0 0 1 110.107 33.741 A 4.055 4.055 0 0 1 110.997 34.898 A 3.624 3.624 0 0 1 111.377 36.549 A 3.062 3.062 0 0 1 111.201 37.441 Q 110.554 39.453 107.525 44.2 A 119.882 119.882 0 0 1 107.422 44.361 Q 103.467 50.538 99.536 56.763 Q 95.668 62.891 95.606 64.548 A 1.413 1.413 0 0 0 95.605 64.6 Q 95.605 66.846 96.436 67.262 Q 97.246 67.667 98.382 67.583 A 5.671 5.671 0 0 0 98.438 67.579 A 3.283 3.283 0 0 0 99.172 67.42 Q 99.92 67.176 100.926 66.577 A 19.07 19.07 0 0 0 101.733 66.065 A 34.091 34.091 0 0 0 104.207 64.257 A 28.147 28.147 0 0 0 105.518 63.136 A 152.555 152.555 0 0 0 109.026 59.848 A 128.852 128.852 0 0 0 110.498 58.399 A 1.811 1.811 0 0 1 110.944 58.099 A 1.471 1.471 0 0 1 111.572 57.96 Q 112.334 57.96 112.602 58.913 A 3.461 3.461 0 0 1 112.695 59.376 A 21.309 21.309 0 0 1 112.89 62.117 A 23.325 23.325 0 0 1 112.891 62.305 A 12.333 12.333 0 0 1 112.873 62.999 Q 112.836 63.64 112.727 64.05 A 1.886 1.886 0 0 1 112.598 64.405 Q 111.44 66.64 107.998 69.692 A 54.855 54.855 0 0 1 106.348 71.095 A 22.287 22.287 0 0 1 103.236 73.254 Q 101.452 74.264 99.724 74.706 A 10.679 10.679 0 0 1 97.07 75.05 Q 96.533 75.05 96.289 75.001 A 19.482 19.482 0 0 1 93.836 74.616 Q 90.747 73.909 89.331 72.242 A 8.065 8.065 0 0 1 87.402 66.846 Q 87.402 63.721 89.526 59.278 Q 91.65 54.835 94.189 51.221 Q 96.729 47.608 98.853 44.703 Q 100.977 41.798 100.977 41.554 A 0.203 0.203 0 0 0 100.86 41.359 Q 100.763 41.309 100.586 41.309 A 2.066 2.066 0 0 0 99.782 41.527 Q 97.97 42.339 93.848 46.192 A 210.704 210.704 0 0 0 85.522 54.395 A 158.629 158.629 0 0 0 78.418 62.305 A 67.749 67.749 0 0 0 77.612 63.296 Q 75.676 65.714 71.115 71.659 A 1879.268 1879.268 0 0 0 70.313 72.706 Q 69.622 73.626 68.172 73.679 A 4.925 4.925 0 0 1 67.993 73.682 A 9.151 9.151 0 0 1 65.806 73.407 A 11.346 11.346 0 0 1 64.697 73.072 A 5.456 5.456 0 0 1 64.042 72.793 Q 62.988 72.252 62.988 71.485 A 1.218 1.218 0 0 1 63.11 71.164 Q 63.959 69.346 70.752 57.789 Q 78.373 44.823 78.513 43.433 A 0.482 0.482 0 0 0 78.516 43.385 A 1.406 1.406 0 0 0 78.428 42.868 Q 78.161 42.188 77.075 42.188 A 1.99 1.99 0 0 0 76.299 42.394 Q 74.679 43.116 71.259 46.374 A 76.317 76.317 0 0 0 71.143 46.485 A 133.267 133.267 0 0 0 61.399 56.796 Q 56.561 62.529 53.047 68.227 A 78.835 78.835 0 0 0 52.002 69.971 Q 51.566 70.649 50.314 72.096 A 64.892 64.892 0 0 1 50.293 72.12 Q 49.03 73.577 48.589 73.585 A 0.267 0.267 0 0 1 48.584 73.585 Z M 53.662 61.475 L 53.662 62.452 A 8.416 8.416 0 0 1 53.608 63.439 Q 53.471 64.603 52.979 65.235 A 30.016 30.016 0 0 1 48.331 69.855 A 24.578 24.578 0 0 1 43.75 72.73 A 27.349 27.349 0 0 1 39.367 74.416 Q 36.701 75.172 34.195 75.195 A 17.138 17.138 0 0 1 34.033 75.196 Q 29.443 75.196 27.051 72.388 Q 24.899 69.864 24.683 65.662 A 18.695 18.695 0 0 1 24.658 64.698 A 44.214 44.214 0 0 1 25.468 56.58 Q 26.214 52.601 27.644 48.172 A 95.983 95.983 0 0 1 29.761 42.31 Q 34.863 29.444 41.26 20.411 Q 53.09 3.647 60.343 0.652 A 7.736 7.736 0 0 1 63.281 0.001 A 6.515 6.515 0 0 1 67.407 1.392 A 4.492 4.492 0 0 1 69.06 4.142 A 6.934 6.934 0 0 1 69.189 5.518 Q 69.189 7.593 67.446 11.454 A 54.102 54.102 0 0 1 66.162 14.088 A 99.556 99.556 0 0 1 61.901 21.477 A 119.365 119.365 0 0 1 58.887 26.002 A 255.971 255.971 0 0 1 54.358 32.27 A 324.807 324.807 0 0 1 49.268 38.917 A 405.6 405.6 0 0 1 39.926 50.416 A 315.326 315.326 0 0 1 32.959 58.399 A 5.152 5.152 0 0 1 32.919 58.729 Q 32.846 59.21 32.665 60.035 A 52.691 52.691 0 0 1 32.544 60.572 Q 32.178 62.159 32.178 63.77 A 3.426 3.426 0 0 0 32.898 65.858 A 5.224 5.224 0 0 0 33.667 66.676 A 5.244 5.244 0 0 0 36.652 67.935 A 6.915 6.915 0 0 0 37.354 67.97 A 7.175 7.175 0 0 0 39.557 67.603 Q 40.447 67.316 41.383 66.806 A 14.014 14.014 0 0 0 42.065 66.407 A 24.304 24.304 0 0 0 45.147 64.153 A 20.764 20.764 0 0 0 46.436 62.94 A 90.531 90.531 0 0 1 48.103 61.263 Q 51.534 57.911 52.49 57.911 A 0.775 0.775 0 0 1 53.157 58.332 Q 53.575 58.998 53.647 60.718 A 18.219 18.219 0 0 1 53.662 61.475 Z M 26.398 62.986 A 11.749 11.749 0 0 0 26.416 62.305 Q 26.416 57.911 25.146 57.911 A 0.184 0.184 0 0 0 25.13 57.912 Q 24.455 57.972 19.922 62.843 A 19.77 19.77 0 0 1 18.511 64.19 A 23.408 23.408 0 0 1 15.747 66.236 A 13.228 13.228 0 0 1 15.473 66.406 Q 14.517 66.982 13.587 67.316 A 7.381 7.381 0 0 1 11.084 67.774 A 4.923 4.923 0 0 1 10.506 67.743 Q 8.838 67.545 8.838 66.114 Q 8.838 65.197 9.31 63.974 A 13.035 13.035 0 0 1 9.814 62.843 Q 10.12 62.263 10.377 61.788 A 59.204 59.204 0 0 1 10.669 61.256 A 13.824 13.824 0 0 1 10.749 61.113 Q 11.005 60.665 11.383 60.075 A 43.897 43.897 0 0 1 11.694 59.596 Q 12.23 58.782 12.427 58.436 A 2.907 2.907 0 0 0 12.5 58.302 Q 22.668 40.784 23.94 37.735 A 2.006 2.006 0 0 0 24.121 37.159 A 2.09 2.09 0 0 0 24.12 37.086 Q 24.081 35.992 22.9 34.669 A 4.95 4.95 0 0 0 22.229 34.039 A 3.352 3.352 0 0 0 20.142 33.302 Q 18.964 33.302 16.985 34.547 A 22.46 22.46 0 0 0 15.698 35.426 A 40.593 40.593 0 0 0 13.168 37.428 A 30.418 30.418 0 0 0 10.767 39.722 Q 8.74 41.895 8.74 42.408 Q 8.74 42.811 9.357 43.559 A 9.602 9.602 0 0 0 9.741 43.995 A 13.567 13.567 0 0 1 10.083 44.374 Q 10.564 44.932 10.694 45.241 A 0.519 0.519 0 0 1 10.742 45.435 Q 10.742 45.756 8.686 49.123 A 225.919 225.919 0 0 1 8.057 50.147 A 136.647 136.647 0 0 0 6.042 53.516 A 164.92 164.92 0 0 0 2.686 59.62 Q 0.755 63.305 0.212 65.729 A 7.878 7.878 0 0 0 0 67.432 A 5.372 5.372 0 0 0 0.328 69.265 Q 0.956 71.006 2.783 72.706 Q 5.566 75.294 9.424 75.294 A 12.227 12.227 0 0 0 12.33 74.916 Q 15.133 74.229 18.506 72.291 A 22.409 22.409 0 0 0 20.255 71.177 A 17.81 17.81 0 0 0 26.123 64.405 Q 26.343 63.929 26.398 62.986 Z M 61.084 8.106 A 1.625 1.625 0 0 0 61.065 7.848 Q 60.989 7.374 60.596 7.374 A 1.769 1.769 0 0 0 59.694 7.761 Q 57.437 9.319 51.611 17.139 Q 44.336 26.905 41.089 32.716 Q 38.565 37.232 36.262 43.549 A 121.406 121.406 0 0 0 34.961 47.315 A 145.524 145.524 0 0 0 38.118 43.42 Q 43.268 36.86 50.903 26.002 A 248.588 248.588 0 0 0 54.363 20.961 Q 61.084 10.883 61.084 8.106 Z M 33.638 22.555 A 6.63 6.63 0 0 0 34.326 19.679 A 3.611 3.611 0 0 0 34.242 18.876 A 2.394 2.394 0 0 0 33.545 17.628 A 2.621 2.621 0 0 0 32.324 16.99 A 3.853 3.853 0 0 0 31.445 16.895 A 6.563 6.563 0 0 0 27.798 18.014 A 9.665 9.665 0 0 0 26.001 19.556 A 10.724 10.724 0 0 0 24.547 21.504 A 7.239 7.239 0 0 0 23.535 25.147 Q 23.535 27.413 25.215 27.927 A 3.862 3.862 0 0 0 26.343 28.077 Q 28.276 28.077 30.105 26.746 A 11.216 11.216 0 0 0 31.738 25.269 Q 32.992 23.909 33.638 22.555 Z"
                vector-effect="non-scaling-stroke"
              />
            </g>
          </svg>
        </div>
      </RouterLink>

      <div class="flex items-center gap-8 grow justify-end">
        <i
          @click="toggleTheme"
          class="fa-regular fa-moon text-base dark:text-zinc-200 hover:text-primary duration-150 cursor-pointer"
        ></i>
        <i
          @click="toggleModal"
          class="fa-regular fa-life-ring text-base dark:text-zinc-200 hover:text-primary duration-150 cursor-pointer"
        ></i>
        <template v-if="route.name === 'city.page'">
          <i
            v-if="route.query.preview"
            @click="addCity"
            class="fa-regular fa-plus text-base dark:text-zinc-200 hover:text-primary duration-150 cursor-pointer"
          ></i>
          <i
            v-if="!route.query.preview"
            @click="removeCity"
            class="fa-regular fa-trash-can text-base dark:text-zinc-200 hover:text-primary duration-150 cursor-pointer"
          ></i>
        </template>
      </div>
    </nav>
  </header>
</template>
